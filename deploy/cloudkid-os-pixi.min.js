!function(e){var t=function(){},i=t.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),n=!1,s=!1,a=null,o=0,l=0,r=null,u=0,h=null,d=null,c=-1,p=!1,g=0,_=0;t.VERSION="1.0.0",i.stage=null,i._renderer=null,i.canvasContainer=null,i._app=null,i.options=null,i._updateFunctions={},t.init=function(e,i){return d||(d=new t,d.initialize(e,i)),d},i.initialize=function(t,i){PIXI.DisplayObjectContainer.call(this),this.options=i||{},this.options.parseQueryString!==e&&(this.options=S(this.options)),this.options.debug!==e&&(Debug.enabled=this.options.debug===!0||"true"===this.options.debug),this.options.minLogLevel!==e&&(Debug.minLogLevel=parseInt(this.options.minLogLevel,10)),"string"==typeof this.options.ip&&Debug.connect(this.options.ip);var n=cloudkid.MediaLoader.init();this.stage=new PIXI.Stage(this.options.backgroundColor||0,!0),this.stage.addChild(this),this.visibleListener=this.onWindowVisibilityChanged.bind(this),w(this.visibleListener);var o=!!this.options.transparent||!1,l=!!this.options.preMultAlpha||!1;this.containerName="string"==typeof t?t:t.attr("id");var r="string"==typeof t?document.getElementById(t):t,u=this.canvasContainer=document.createElement("div");r.appendChild(u),u.id="CKOS";var d=this.options.width||r.innerWidth,c=this.options.height||r.innerHeight;if(this._renderer="canvas2d"==this.options.forceContext?new PIXI.CanvasRenderer(d,c,null,o):"webgl"==this.options.forceContext?new PIXI.WebGLRenderer(d,c,null,o,l):PIXI.autoDetectRenderer(d,c,null,o,l),u.appendChild(this._renderer.view),u.setAttribute("style","position:relative;width:"+d+"px;height:"+c+"px"),this._renderer.clearView=!!this.options.clearView,this.options.showFramerate&&(a=new PIXI.Text("FPS: 0.000",{font:"10px Arial",fill:"black",stroke:"white",strokeThickness:2}),a.x=a.y=5,this.addChild(a)),this._renderer.render(this.stage),h=this.tick.bind(this),p=this.options.raf||!1,this.fps=this.options.fps||60,this.removeApp(),this.options.versionsFile!==e){s=!1;var g=this;n.cacheManager.addVersionsFile(this.options.versionsFile,function(){s=!0,g._app&&(g.addChildAt(g._app,0),g._app.init(),g.resume())})}else s=!0};var b=null,f=null,v="visible",m="hidden",w=function(e){b="hidden",b in document?document.addEventListener("visibilitychange",e):(b="mozHidden")in document?document.addEventListener("mozvisibilitychange",e):(b="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",e):(b="msHidden")in document?document.addEventListener("msvisibilitychange",e):"onfocusin"in document?(f={focusin:v,focusout:m},document.onfocusin=document.onfocusout=e):(f={focus:v,pageshow:v,blur:m,pagehide:m},window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e)},k=function(e){var t="hidden";t in document?document.removeEventListener("visibilitychange",e):(t="mozHidden")in document?document.removeEventListener("mozvisibilitychange",e):(t="webkitHidden")in document?document.removeEventListener("webkitvisibilitychange",e):(t="msHidden")in document&&document.removeEventListener("msvisibilitychange",e),document.onfocusin=document.onfocusout=null,window.onpageshow=window.onpagehide=window.onfocus=window.onblur=null};i.onWindowVisibilityChanged=function(e){var t="visible",i="hidden";e=e||window.event;var n;n=f?f[e.type]:document[b]?i:t,n==i?this.pause():this.resume()};var S=function(e){var t=window.location.href,i=t.indexOf("?");if(-1==i)return e;var n=0>i?"":t.substr(i+1),s=n.indexOf("#");n=0>s?n:n.substring(0,s);var a,o=n.split("&");for(var l in o)a=o[l].split("="),e[a[0]]=a[1];return e};i.pause=function(){-1!=c&&(p?window.cancelAnimationFrame&&cancelAnimationFrame(c):clearTimeout(c),c=-1),n=!0};var y=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);y=y?y.bind(performance):function(){return(new Date).getTime()},i.getTime=function(){return y()},i.resume=function(){n=!1,-1==c&&(c=p?requestAnimFrame(h):x(h)),l=o=this.getTime()},Object.defineProperty(i,"fps",{get:function(){return g},set:function(e){"number"==typeof e&&(g=e,_=1e3/g|0)}}),Object.defineProperty(i,"stageWidth",{get:function(){return d._renderer.view.width}}),Object.defineProperty(i,"stageHeight",{get:function(){return d._renderer.view.height}});var x=function(e,t){var i=0;return t&&(i=Math.max(0,_-t)),setTimeout(e,i)};i.removeApp=function(e){var t=!1,i=this.stage;return this._app&&(this._app.parent==this&&this.removeChild(this._app),i.removeChildren(),this._app.destroy(),t=!0),this._app=null,this.pause(),e||(i.addChild(this),a&&(a.text="FPS: 0.000"),o=l=r=u=0,this._renderer.render(i)),t},i.addApp=function(e){if(this.removeApp(),!(e instanceof cloudkid.Application))throw new Error("Can only objects that inherit cloudkid.Application");this._app=e,s&&(this.addChildAt(e,0),this._app.init(),this.resume())},i.getApp=function(){return this._app},i.addUpdateCallback=function(t,i){this._updateFunctions[t]===e&&(this._updateFunctions[t]=i)},i.removeUpdateCallback=function(t){this._updateFunctions[t]!==e&&delete this._updateFunctions[t]},i.tick=function(){if(n)return c=-1,void 0;var e=this.getTime(),t=e-o;if(a&&a.visible){u++;var i=e-l;i>1e3&&(r=1e3/i*u,a.setText("FPS: "+Math.round(1e3*r)/1e3),l=e,u=0)}o=e,this._app&&this._app.update(t);for(var s in this._updateFunctions)this._updateFunctions[s](t);this._renderer.render(this.stage),c=p?requestAnimFrame(h):x(h,this.getTime()-o)},i.resize=function(e,t){this._renderer.resize(e,t),this.canvasContainer.setAttribute("style","position:relative;width:"+e+"px;height:"+t+"px")},i.destroy=function(){var e=this.stage,t=cloudkid.MediaLoader.instance;this.pause(),this.removeApp(!0),d=null,t.destroy(),this.stage=null,this._updateFunctions=null,k(this.visibleListener),this.removeChildren(!0),e.destroy(),this._renderer.destroy(),this._renderer=null,this.canvasContainer=null},Object.defineProperty(t,"instance",{get:function(){if(!d)throw"Call cloudkid.OS.init(canvasId)";return d}}),namespace("cloudkid").OS=t}(),function(){"use strict";var e=function(){},t="undefined"!=typeof window.Storage,i=-1;e.remove=function(n){t?(localStorage.removeItem(n),sessionStorage.removeItem(n)):e.write(n,"",i)},e.write=function(e,n,s){if(t)s?sessionStorage.setItem(e,JSON.stringify(n)):localStorage.setItem(e,JSON.stringify(n));else{var a;a=s?s!==i?"":"; expires=Thu, 01 Jan 1970 00:00:00 GMT":"; expires="+new Date(2147483646e3).toGMTString(),document.cookie=e+"="+escape(JSON.stringify(n))+a+"; path=/"}},e.read=function(e){if(t){var i=localStorage.getItem(e)||sessionStorage.getItem(e);return i?JSON.parse(i):null}var n,s=e+"=",a=document.cookie.split(";"),o=0;for(o=0;o<a.length;o++){for(n=a[o];" "==n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(s))return JSON.parse(unescape(n.substring(s.length,n.length)))}return null},namespace("cloudkid").SavedData=e}(),function(){window.URL=window.URL||window.webkitURL,window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,namespace("cloudkid").createWorker=function(e){if(!window.URL||!window.Worker)return new FallbackWorker(e);var t;try{t=new Blob([e],{type:"application/javascript"})}catch(i){if(!window.BlobBuilder)return new FallbackWorker(e);try{t=new BlobBuilder,t.append(e),t=t.getBlob()}catch(n){return new FallbackWorker(e)}}if(!t)return new FallbackWorker(e);try{var s=new Worker(URL.createObjectURL(t));return s}catch(i){return new FallbackWorker(e)}};var SubWorker=function(codeString,parent){this._wParent=parent,eval(codeString)},p=SubWorker.prototype;p.onmessage=null,p.postMessage=function(e){var t=this._wParent;setTimeout(t.onmessage.bind(t,{data:e}),1)};var FallbackWorker=function(e){this._wChild=new SubWorker(e,this)};p=FallbackWorker.prototype,p.postMessage=function(e){var t=this._wChild;setTimeout(t.onmessage.bind(t,{data:e}),1)},p.terminate=function(){this.onmessage=null;var e=this._wChild;e._wParent=null,e.onmessage=null,this._wChild=null},p.onmessage=null,p._wChild=null}(),function(){var e=function(e,t,i,n){t[i]?t[n]=e:e()};e.create=function(t,i,n,s){return e.bind(this,t,i,n,s)},namespace("cloudkid").CombinedCallback=e}(),function(){var e,t=function(){PIXI.DisplayObjectContainer.call(this)};e=t.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),e.init=function(){},e.update=function(){},e.destroy=function(){},e.resize=function(){},namespace("cloudkid").Application=t}(),function(){var e=function(){},t=e.prototype;e.PRIORITY_HIGH=1,e.PRIORITY_NORMAL=0,e.PRIORITY_LOW=-1,t.url=null,t.data=null,t.callback=null,t.priority=0,t.progress=0,t.updateCallback=null,t._boundFail=null,t._boundProgress=null,t._boundComplete=null,t.toString=function(){return"[LoaderQueueItem(url:'"+this.url+"', priority:"+this.priority+")]"},t.destroy=function(){this.callback=null,this.updateCallback=null,this.data=null,this._boundFail=null,this._boundProgress=null,this._boundComplete=null},namespace("cloudkid").LoaderQueueItem=e}(),function(){var e=function(){},t=e.prototype;e._instance=null;var n=null,s=null,a=null,o=null,l=null,r=null,u=0,h=null;t._canLoad=!0,t.maxSimultaneousLoads=2,t.cacheManager=null,e.init=function(){return e._instance||(e._instance=new e,e._instance._initialize()),e._instance},Object.defineProperty(e,"instance",{get:function(){if(!e._instance)throw"Call cloudkid.MediaLoader.init()";return e._instance}}),t.destroy=function(){var t,i,u,d=this.queue;if(d){for(t=0,i=d.length;t>t;++t)d[t].destroy();for(d=o,t=0,i=d.length;t>t;++t)d[t].destroy();for(d=r,t=0,i=d.length;t>t;++t)d[t].destroy();for(u in a)s[u].destroy(),a[u].close()}e._instance=null,this.cacheManager&&this.cacheManager.destroy(),this.cacheManager=null,n=null,r=null,l=null,o=null,s=null,h=null,a=null},t._initialize=function(){o=[],l=[],r=[],n=[],s={},a={},h={},this.cacheManager=new cloudkid.CacheManager},t.load=function(e,t,i,s,a){var o=this._getQI(),l=cloudkid.OS.instance.options.basePath;void 0!==l&&/^http(s)?\:/.test(e)===!1&&-1==e.search(l)&&(o.basePath=l),o.url=e,o.callback=t,o.updateCallback=i||null,o.priority=s||cloudkid.LoaderQueueItem.PRIORITY_NORMAL,o.data=a||null,n.push(o),n.sort(function(e,t){return e.priority-t.priority}),this._tryNextLoad()},t._onLoadFailed=function(e,t){Debug.error("Unable to load file: "+e.url+" - reason: "+t.error);var i=a[e.url];i.removeAllEventListeners(),i.close(),this._poolLoader(i),delete s[e.url],delete a[e.url],h[e.url]?h[e.url]++:h[e.url]=1,h[e.url]>3?this._loadDone(e,null):(u--,n.push(e),this._tryNextLoad())},t._onLoadProgress=function(e,t){e.progress=t.progress,e.updateCallback&&e.updateCallback(e.progress)},t._onLoadCompleted=function(e,t){var i=a[e.url];i.removeAllEventListeners(),i.close(),this._poolLoader(i),delete s[e.url],delete a[e.url],this._loadDone(e,this._getResult(t.result,e.url,i))},t._tryNextLoad=function(){if(!(u>this.maxSimultaneousLoads-1||0===n.length)){u++;var e=n.shift();s[e.url]=e;var t=this._getLoader(e.basePath);a[e.url]=t,t.addEventListener("fileload",e._boundComplete),t.addEventListener("error",e._boundFail),t.addEventListener("fileprogress",e._boundProgress);var i=this.cacheManager.prepare(e.url);t.loadFile(e.data?{id:e.data.id,src:i,data:e.data}:i)}},t._loadDone=function(e,t){u--,e.data&&t&&(t.id=e.data.id),e.callback(t),this._poolQI(e),this._tryNextLoad()},t.cancel=function(e){var t=s[e],o=a[e];if(t&&o)return o.close(),delete a[e],delete s[t.url],u--,this._poolLoader(o),this._poolQI(t),!0;for(i=0,len=n.length;len>i;i++)if(t=n[i],t.url==e)return n.splice(i,1),this._poolQI(t),!0;return!1},t._getQI=function(){var e;return o.length?e=o.pop():(e=new cloudkid.LoaderQueueItem,e._boundFail=this._onLoadFailed.bind(this,e),e._boundProgress=this._onLoadProgress.bind(this,e),e._boundComplete=this._onLoadCompleted.bind(this,e)),e},t._poolQI=function(e){o.push(e),e.callback=e.updateCallback=e.data=e.url=null,e.progress=0},t._getLoader=function(e){var t;return l.length?(t=l.pop(),t._basePath=e):t=new createjs.LoadQueue(!0,e),createjs.Sound&&t.installPlugin(createjs.Sound),t},t._poolLoader=function(e){e.removeAll(),l.push(e)},t._getResult=function(e,t,i){var n;return r.length?(n=r.pop(),n.content=e,n.url=t,n.loader=i):n=new cloudkid.MediaLoaderResult(e,t,i),n},t._poolResult=function(e){e.content=e.url=e.loader=e.id=null,r.push(e)},namespace("cloudkid").MediaLoader=e}(),function(){var e=function(e,t,i){this.content=e,this.url=t,this.loader=i},t=e.prototype;t.content=null,t.url=null,t.loader=null,t.toString=function(){return"[MediaLoaderResult('"+this.url+"')]"},t.destroy=function(){this.callback=null,this.url=null,this.content=null},namespace("cloudkid").MediaLoaderResult=e}(),function(e){var t=function(){this.initialize()},i=t.prototype={};i._versions=null,i.cacheBust=!1,i.initialize=function(){this._versions=[];var e=cloudkid.OS.instance.options.cacheBust;this.cacheBust=e?"true"===e||e===!0:!1},i.destroy=function(){this._versions=null},i.addVersionsFile=function(e,t,i){Debug.assert(/^.*\.txt$/.test(e),"The versions file must be a *.txt file");var n=cloudkid.MediaLoader.instance;if(this.cacheBust)return t&&t(),void 0;this.addVersion(e,Math.round(1e5*Math.random()));var s=this;n.load(e,function(e){if(e&&e.content){var n,a,o=e.content.replace(/\r/g,"").split("\n");for(n=0;n<o.length;n++)o[n]&&(a=o[n].split(" "),2==a.length&&s.addVersion((i||"")+a[0],a[1]))}t&&t()})},i.addVersion=function(e,t){var i=this._getVersionByUrl(e);i||this._versions.push({url:e,version:t})},i._getVersionByUrl=function(e){var t,i=this._versions.length;for(t=0;i>t;t++)if(e==this._versions[t].url)return this._versions[t];return null},i.prepare=function(t,i){var n=this._getVersionByUrl(t);if(this.cacheBust&&/(\?|\&)cb\=[0-9]*/.test(t)===!1?(this._cbVal||(this._cbVal=(new Date).getTime().toString()),t=t+(t.indexOf("?")<0?"?":"&")+"cb="+this._cbVal):n&&/(\?|\&)v\=[0-9]*/.test(t)===!1&&(t=t+(t.indexOf("?")<0?"?":"&")+"v="+n.version),i){var s=cloudkid.OS.instance.options.basePath;/^http(s)?\:/.test(t)===!1&&s!==e&&-1==t.search(s)&&(t=s+t)}return t},namespace("cloudkid").CacheManager=t}(),function(e){var t=function(e,t,i){PIXI.DisplayObjectContainer.call(this),this.initialize(e,t,i)},i=t.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);i.back=null,i.label=null,i.releaseCallback=null,i.overCallback=null,i.outCallback=null,i._enabled=!1,i._isDown=!1,i._isOver=!1,i._isSelected=!1,i._isSelectable=!1,i._isHighlighted=!1,i._overCB=null,i._outCB=null,i._downCB=null,i._upCB=null,i._upOutCB=null,i._upTex=null,i._overTex=null,i._downTex=null,i._disabledTex=null,i._selectedTex=null,i._highlightedTex=null,i._slave=null,i._slaveUpTex=null,i._slaveOverTex=null,i._slaveDownTex=null,i._slaveDisabledTex=null,i._slaveSelectedTex=null,i._slaveHighlightedTex=null,i._width=0,i._height=0,i.initialize=function(t,i,n){if(this.back=new PIXI.Sprite(t.up),this.addChild(this.back),this._overCB=this._onOver.bind(this),this._outCB=this._onOut.bind(this),this._downCB=this._onDown.bind(this),this._upCB=this._onUp.bind(this),this._upOutCB=this._onUpOutside.bind(this),this._upTex=t.up,this._overTex=t.over||this._upTex,this._downTex=t.down||this._upTex,this._disabledTex=t.disabled||this._upTex,this._highlightedTex=t.highlighted||this._overTex,t.selected&&(this._isSelectable=!0,this._selectedTex=t.selected),t.slave&&t.slaveSettings){this._slave=t.slave;var s=t.slaveSettings;this._slaveUpTex=s.up,this._slaveOverTex=s.over||this._slaveUpTex,this._slaveDownTex=s.down||this._slaveUpTex,this._slaveDisabledTex=s.disabled||this._slaveUpTex,this._slaveHighlightedTex=s.highlighted||this._slaveOverTex,this._isSelectable&&(this._slaveSelectedTex=s.selected||this._slaveUpTex)}if(t.scale){var a=t.scale||1;this.back.scale.x=this.back.scale.y=a,this._slave&&(this._slave.scale.x=this._slave.scale.x=a)}if(i){this.label="bitmap"==i.type?new PIXI.BitmapText(i.text,i.style):new PIXI.Text(i.text,i.style),this.addChild(this.label),this.label.position.x=.5*(this.back.width-this.label.width);var o=this.label.height;this.label.position.y=.5*(this.back.height-o)+.125*o}this._width=this.back.width,this._height=this.back.height,this.enabled=n===e?!0:!!n},Object.defineProperty(i,"width",{get:function(){return this._width*this.scale.x},set:function(e){this.scale.x=e/this._width}}),Object.defineProperty(i,"height",{get:function(){return this._height*this.scale.y},set:function(e){this.scale.y=e/this._height}}),i.setText=function(e){if(this.label){this.label.setText(e),this.label.forceUpdateText(),this.label.position.x=.5*(this.back.width-this.label.width);var t=this.label.height;this.label.position.y=.5*(this.back.height-t)+.125*t}},Object.defineProperty(i,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e,this.buttonMode=e,this.interactive=e,e?(this.mousedown=this.touchstart=this._downCB,this.mouseover=this._overCB,this.mouseout=this._outCB):(this.mousedown=this.touchstart=this.mouseover=this.mouseout=null,this.mouseup=this.touchend=this.mouseupoutside=this.touchendoutside=null,this._isDown=this._isOver=!1,this.__isOver=!1),this._updateState()}}),Object.defineProperty(i,"selected",{get:function(){return this._isSelected},set:function(e){this._isSelectable&&(this._isSelected=e,this._updateState())}}),Object.defineProperty(i,"highlighted",{get:function(){return this._isHighlighted},set:function(e){this._isHighlighted=e,this._updateState()}}),i._updateState=function(){this.back&&(this._isHighlighted?this.back.setTexture(this._highlightedTex):this._enabled?this._isDown?this.back.setTexture(this._downTex):this._isOver?this.back.setTexture(this._overTex):this._isSelected?this.back.setTexture(this._selectedTex):this.back.setTexture(this._upTex):this.back.setTexture(this._disabledTex),this._slave&&(this._isHighlighted?this._slave.setTexture(this._slaveHighlightedTex):this._enabled?this._isDown?this._slave.setTexture(this._slaveDownTex):this._isOver?this._slave.setTexture(this._slaveOverTex):this._isSelected?this._slave.setTexture(this._slaveSelectedTex):this._slave.setTexture(this._slaveUpTex):this._slave.setTexture(this._slaveDisabledTex)))},i._onOver=function(){this._isOver=!0,this._updateState(),this.overCallback&&this.overCallback(this)},i._onOut=function(){this._isOver=!1,this._updateState(),this.outCallback&&this.outCallback(this)},i._onDown=function(e){e.originalEvent.preventDefault(),this._isDown=!0,this._updateState(),this.mouseup=this.touchend=this._upCB,this.mouseupoutside=this.touchendoutside=this._upOutCB},i._onUp=function(e){e.originalEvent.preventDefault(),this._isDown=!1,this.mouseup=this.touchend=null,this.mouseupoutside=this.touchendoutside=null,this._updateState(),this.releaseCallback&&this.releaseCallback(this)},i._onUpOutside=function(){this._isDown=!1,this.mouseup=this.touchend=null,this.mouseupoutside=this.touchendoutside=null,this._updateState()},i.destroy=function(){this.mousedown=this.touchstart=this.mouseover=this.mouseout=null,this.mouseup=this.touchend=this.mouseupoutside=this.touchendoutside=null,this.removeChildren(!0),this._upTex=null,this._overTex=null,this._downTex=null,this._disabledTex=null,this._selectedTex=null,this._highlightedTex=null,this.label=null,this.back=null,this.releaseCallback=null,this.overCallback=null,this.outCallback=null,this._slave=null,this._slaveUpTex=null,this._slaveOverTex=null,this._slaveDownTex=null,this._slaveDisabledTex=null,this._slaveSelectedTex=null,this._slaveHighlightedTex=null},namespace("cloudkid").Button=t}(),function(){var e=function(e,t){this.initialize(e,t)},t=e.prototype={};t._updateCallback=null,t.draggedObj=null,t._dragOffset=null,t.dragStartThreshold=20,t.mouseDownStagePos=null,t.mouseDownObjPos=null,t.isTouchMove=!1,t.isHeldDrag=!1,t.isStickyClick=!1,t.allowStickyClick=!0,t._theStage=null,t._dragStartCallback=null,t._dragEndCallback=null,t._triggerHeldDragCallback=null,t._triggerStickyClickCallback=null,t._stageMouseUpCallback=null,t._draggableObjects=null;var i=null,n=0,s=1;t.initialize=function(e,t){this._updateCallback=this._updateObjPosition.bind(this),this._triggerHeldDragCallback=this._triggerHeldDrag.bind(this),this._triggerStickyClickCallback=this._triggerStickyClick.bind(this),this._stageMouseUpCallback=this._stopDrag.bind(this),this._theStage=cloudkid.OS.instance.stage,this._dragStartCallback=e,this._dragEndCallback=t,this._draggableObjects=[],this.mouseDownStagePos=new PIXI.Point(0,0),this.mouseDownObjPos=new PIXI.Point(0,0),i=new PIXI.Point(0,0)},t.startDrag=function(e,t){this._objMouseDown(n,e,t)},t._objMouseDown=function(e,t,i){null===this.draggedObj&&(this.draggedObj=t,createjs.Tween.removeTweens(this.draggedObj),createjs.Tween.removeTweens(this.draggedObj.position),this._dragOffset=i.getLocalPosition(this.draggedObj.parent),this._dragOffset.x-=this.draggedObj.position.x,this._dragOffset.y-=this.draggedObj.position.y,this.mouseDownObjPos.x=this.draggedObj.position.x,this.mouseDownObjPos.y=this.draggedObj.position.y,this.mouseDownStagePos.x=i.global.x,this.mouseDownStagePos.y=i.global.y,this.allowStickyClick&&e!=s?(this.draggedObj.mousemove=this._triggerHeldDragCallback,this._theStage.interactionManager.stageUp=this._triggerStickyClickCallback):(this.isTouchMove=e==s,this.isHeldDrag=!0,this._startDrag()))},t._triggerStickyClick=function(){this.isStickyClick=!0,this.draggedObj.mousemove=null,this._theStage.interactionManager.stageUp=null,this._startDrag()},t._triggerHeldDrag=function(e){var t=e.global.x-this.mouseDownStagePos.x,i=e.global.y-this.mouseDownStagePos.y;t*t+i*i>=this.dragStartThreshold*this.dragStartThreshold&&(this.isHeldDrag=!0,this.draggedObj.mousemove=null,this._theStage.interactionManager.stageUp=null,this._startDrag())},t._startDrag=function(){var e=this._theStage.interactionManager;e.stageUp=this._stageMouseUpCallback,this.draggedObj.mousemove=this.draggedObj.touchmove=this._updateCallback,this._dragStartCallback(this.draggedObj)},t.stopDrag=function(e){this._stopDrag(null,e===!0)},t._stopDrag=function(e,t){this.draggedObj&&(this.draggedObj.touchmove=this.draggedObj.mousemove=null);var i=this._theStage.interactionManager;i.stageUp=null;var n=this.draggedObj;this.draggedObj=null,this.isTouchMove=!1,this.isStickyClick=!1,this.isHeldMove=!1,t!==!1&&this._dragEndCallback(n)},t._updateObjPosition=function(e){if(this.isTouchMove||this._theStage.interactionManager.mouseInStage){if(!this.draggedObj||!this.draggedObj.parent)return this._stopDrag(null,!1),void 0;var t=e.getLocalPosition(this.draggedObj.parent,i),n=this.draggedObj._dragBounds;this.draggedObj.position.x=a(t.x-this._dragOffset.x,n.x,n.right),this.draggedObj.position.y=a(t.y-this._dragOffset.y,n.y,n.bottom)}};var a=function(e,t,i){return t>e?t:e>i?i:e},o=function(){this.mousedown=this._onMouseDownListener,this.touchstart=this._onTouchStartListener,this.buttonMode=this.interactive=!0},l=function(){this.mousedown=this.touchstart=null,this.buttonMode=this.interactive=!1},r=function(e,t){this._dragMan._objMouseDown(e,this,t)};t.addObject=function(e,t){if(!t){var i=cloudkid.OS.instance._renderer.view;t={x:0,y:0,width:i.width,height:i.height}}t.right=t.x+t.width,t.bottom=t.y+t.height,e._dragBounds=t,this._draggableObjects.indexOf(e)>=0||(e.enableDrag=o,e.disableDrag=l,e._onMouseDownListener=r.bind(e,n),e._onTouchStartListener=r.bind(e,s),e._dragMan=this,this._draggableObjects.push(e))},t.removeObject=function(e){var t=this._draggableObjects.indexOf(e);t>=0&&(e.disableDrag(),delete e.enableDrag,delete e.disableDrag,delete e._onMouseDownListener,delete e._onTouchStartListener,delete e._dragMan,delete e._dragBounds,this._draggableObjects.splice(t,1))},t.destroy=function(){null!==this.draggedObj&&this._stopDrag(null,!1),this._updateCallback=null,this._dragStartCallback=null,this._dragEndCallback=null,this._triggerHeldDragCallback=null,this._triggerStickyClickCallback=null,this._stageMouseUpCallback=null,this._theStage=null;for(var e=this._draggableObjects.length-1;e>=0;--e){var t=this._draggableObjects[e];t.disableDrag(),delete t.enableDrag,delete t.disableDrag,delete t._onMouseDownListener,delete t._dragMan,delete t._dragBounds}this._draggableObjects=null},namespace("cloudkid").DragManager=e}(),function(){var e=function(){this._timelines=[],this._boundUpdate=this._update.bind(this)},t=e.prototype={},i=null;t._timelines=null,t._numAnims=0,t._updateAlias="animator",t._boundUpdate=null;var n=null;e.init=function(){i=new e,n=[]},Object.defineProperty(e,"instance",{get:function(){return i}}),t.play=function(e,t,i,r,u,h,d){if(null===e||!(e instanceof PIXI.Spine)&&!e.updateAnim)return i&&i(),void 0;this.stop(e),r=r||!1,h=h?.001*h:0;var c=n.length?n.pop().init(e,i||null,u||1):new l(e,i||null,u||1);if(c.isSpine){var p;if("string"==typeof t){if(!s(e,t))return this._repool(c),i&&i(),void 0;e.state.setAnimationByName(t,r),e.updateAnim(h>0?h*c.speed:0)}else if("string"==typeof t[0]){for(e.state.setAnimationByName(t[0],!1),p=1;p<t.length;++p)e.state.addAnimationByName(t[p],r&&p==t.length-1);e.updateAnim(h>0?h*c.speed:0)}else for(c.spineStates=new Array(t.length),c.speed=new Array(t.length),p=0;p<t.length;++p){var g=new PIXI.spine.AnimationState(e.stateData);c.spineStates[p]=g,g.setAnimationByName(t[p].anim,r||t[p].loop),c.speed[p]=t[p].speed?t[p].speed:u||1,h>0&&g.update(h*c.speed[p]),g.apply(e.skeleton)}}else t&&t instanceof Array&&(e.textures=t,e.updateDuration()),e.loop=r,e.onComplete=this._onMovieClipDone.bind(this,c),e.gotoAndPlay(0),h>0&&e.update(h*c.speed);return d&&(c.playSound=!0,c.soundStart=d.start,c.soundAlias=d.alias,0===c.soundStart?c.soundInst=cloudkid.Sound.instance.play(c.soundAlias,void 0,void 0,void 0,void 0,void 0,void 0,o.bind(this,c),a.bind(this,c)):cloudkid.Sound.instance.preloadSound(d.alias)),c.loop=r,c.time=h>0?h:0,this._timelines.push(c),1==++this._numAnims&&cloudkid.OS.instance.addUpdateCallback(this._updateAlias,this._boundUpdate),c};var s=function(e,t){return null!==e.stateData.skeletonData.findAnimation(t)};t.stop=function(e,t){for(var i=0;i<this._numAnims;++i)if(this._timelines[i].clip===e){var n=this._timelines[i];this._timelines.splice(i,1),0===--this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),t&&n.callback&&n.callback(),n.soundInst&&n.soundInst.stop(),this._repool(n);break}},t.stopAll=function(){for(var e=0;e<this._numAnims;++e){var t=this._timelines[e];t.soundInst&&t.soundInst.stop(),this._repool(t);break}cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),this._timelines.length=this._numAnims=0},t._repool=function(e){e.clip=null,e.callback=null,e.loop=!1,e.spineStates=null,e.speed=null,e.soundInst=null,n.push(e)},t._update=function(e){for(var t=.001*e,i=this._numAnims-1;i>=0;--i){var n=this._timelines[i],s=n.time;n.soundInst?n.time=n.soundStart+.001*n.soundInst.position:(n.time+=t,n.playSound&&n.time>=n.soundStart&&(n.time=n.soundStart,n.soundInst=cloudkid.Sound.instance.play(n.soundAlias,void 0,void 0,void 0,void 0,void 0,void 0,o.bind(this,n),a.bind(this,n))));var l=n.clip;if(n.isSpine)if(n.spineStates){for(var r=!1,u=0,h=n.spineStates.length;h>u;++u){var d=n.spineStates[u];d.update((n.time-s)*n.speed[u]),d.apply(l.skeleton),!d.currentLoop&&d.isComplete()&&(r=!0)}r&&(this._timelines.splice(i,1),this._numAnims--,n.callback&&n.callback(),this._repool(n))}else{l.updateAnim((n.time-s)*n.speed);var c=l.state;!c.currentLoop&&0===c.queue.length&&c.currentTime>=c.current.duration&&(this._timelines.splice(i,1),this._numAnims--,n.callback&&n.callback(),this._repool(n))}else l.updateAnim((n.time-s)*n.speed)}0===this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias)};var a=function(e){e.playSound=!1,e.soundEnd=e.soundStart+.001*e.soundInst.length},o=function(e){e.time=e.soundEnd||e.soundStart,e.soundInst=null};t._onMovieClipDone=function(e){for(var t=0;t<this._numAnims;++t)if(this._timelines[t]===e){var i=this._timelines[t];i.clip.onComplete=null,this._timelines.splice(t,1),0===--this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),i.callback&&i.callback(),this._repool(i);break}},t.destroy=function(){i=null,n=null,this._timelines=null,cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),this._boundUpdate=null};var l=function(e,t,i){this.init(e,t,i)};l.constructor=l,l.prototype.init=function(e,t,i){return this.clip=e,this.isSpine=e instanceof PIXI.Spine,this.callback=t,this.speed=i,this.spineStates=null,this.loop=null,this.time=0,this.soundAlias=null,this.soundInst=null,this.playSound=!1,this.soundStart=0,this.soundEnd=0,this},namespace("cloudkid").PixiAnimator=e}(),function(){var e=function(){};e.prototype={},e.positionItems=function(t,i){var n,s,a;a=Math.PI/180;for(var o in i){var l=t[o];if(l){var r=i[o];if(l.position.x=r.x,l.position.y=r.y,s=r.scale,s&&(l.scale.x*=s.x,l.scale.y*=s.y),s=r.pivot,s&&(l.pivot.x=s.x,l.pivot.y=s.y),n=r.rotation,n&&(l.rotation=n*a),r.hitArea){var u=r.hitArea;l.hitArea=e.generateHitArea(u)}}else Debug.error("could not find object '"+o+"'")}},e.generateHitArea=function(e,i){if(i||(i=1),t(e)){if(1==i)return new PIXI.Polygon(e);for(var n=[],s=0,a=e.length;a>s;++s)n.push(new PIXI.Point(e[s].x*i,e[s].y*i));return new PIXI.Polygon(n)}return"rect"!=e.type&&e.type?"ellipse"==e.type?new PIXI.Ellipse((e.x-.5*e.w)*i,(e.y-.5*e.h)*i,e.w*i,e.h*i):"circle"==e.type?new PIXI.Circle(e.x*i,e.y*i,e.r*i):null:new PIXI.Rectangle(e.x*i,e.y*i,e.w*i,e.h*i)};var t=function(e){return"[object Array]"===Object.prototype.toString.call(e)};namespace("cloudkid").Positioner=e}(),function(){var e=function(e,t,i){this.width=e,this.height=t,this.ppi=i};e.prototype={},namespace("cloudkid").ScreenSettings=e}(),function(){var e=function(e,t,i){this._item=e,this._settings=t,this._designedScreen=i,this.origScaleX=e.scale.x,this.origScaleY=e.scale.y,this.origWidth=e.width,this.origBounds={x:0,y:0,width:e.width,height:e.height},this.origBounds.right=this.origBounds.x+this.origBounds.width,this.origBounds.bottom=this.origBounds.y+this.origBounds.height;var n=cloudkid.UIScaler;switch(t.vertAlign){case n.ALIGN_TOP:this.origMarginVert=e.position.y+this.origBounds.y;break;case n.ALIGN_CENTER:this.origMarginVert=.5*i.height-e.position.y;break;case n.ALIGN_BOTTOM:this.origMarginVert=i.height-(e.position.y+this.origBounds.bottom)}switch(t.horiAlign){case n.ALIGN_LEFT:this.origMarginHori=e.position.x+this.origBounds.x;break;case n.ALIGN_CENTER:this.origMarginHori=.5*i.width-e.position.x;break;case n.ALIGN_RIGHT:this.origMarginHori=i.width-(e.position.x+this.origBounds.right)}},t=e.prototype={};t.origMarginHori=0,t.origMarginVert=0,t.origWidth=0,t.origScaleX=0,t.origScaleY=0,t.origBounds=null,t._settings=null,t._item=null,t._designedScreen=null,t.resize=function(e){var t=e.height/this._designedScreen.height,i=e.ppi/this._designedScreen.ppi,n=(e.width-this._designedScreen.width*t)/2,s=t/i;this._settings.minScale&&s<this._settings.minScale?s=this._settings.minScale:this._settings.maxScale&&s>this._settings.maxScale&&(s=this._settings.maxScale),s*=i,this._item.scale.x=this.origScaleX*s,this._item.scale.y=this.origScaleY*s;var a;a=this.origMarginVert*t;var o=cloudkid.UIScaler;switch(this._settings.vertAlign){case o.ALIGN_TOP:this._item.position.y=a-this.origBounds.y*s;break;case o.ALIGN_CENTER:this._item.position.y=.5*e.height-a;break;case o.ALIGN_BOTTOM:this._item.position.y=e.height-a-this.origBounds.bottom*s}switch(a=this.origMarginHori*t,this._settings.horiAlign){case o.ALIGN_LEFT:this._item.position.x=this._settings.titleSafe?n+a-this.origBounds.x*s:a-this.origBounds.x*s;break;case o.ALIGN_CENTER:this._item.position.x=this._settings.centeredHorizontally?.5*(e.width-this._item.width):.5*e.width-a;break;case o.ALIGN_RIGHT:this._item.position.x=this._settings.titleSafe?e.width-n-a-this.origBounds.right*s:e.width-a-this.origBounds.right*s}},t.destroy=function(){this._item=null,this._settings=null,this._designedScreen=null},namespace("cloudkid").UIElement=e}(),function(){var e=function(){},t=e.prototype={};t.vertAlign=null,t.horiAlign=null,t.titleSafe=!1,t.maxScale=1,t.minScale=1,t.centeredHorizontally=!1,namespace("cloudkid").UIElementSettings=e}(),function(){var e=function(e,t,i,n){this._parent=e,this._items=[],this._designedScreen=new cloudkid.ScreenSettings(t,i,n)},t=e.prototype={};e._currentScreen=new cloudkid.ScreenSettings(0,0,0),e._initialized=!1,t._parent=null,t._designedScreen=null,t._items=null,e.ALIGN_TOP="top",e.ALIGN_BOTTOM="bottom",e.ALIGN_LEFT="left",e.ALIGN_RIGHT="right",e.ALIGN_CENTER="center",e.fromJSON=function(t,i,n,s){"boolean"!=typeof s&&(s=!0);
var a,o,l,r,u,h=new e(t,i.designedWidth,i.designedHeight,i.designedPPI);for(o in n)a=n[o],a.align?(l=a.align.split("-"),r=l[0],u=l[1]):(r=ALIGN_CENTER,u=ALIGN_CENTER),h.add(t[o],r,u,a.titleSafe||!1,a.minScale||0/0,a.maxScale||0/0,a.centeredHorizontally||!1);return h.resize(),s&&h.destroy(),h},e.init=function(t,i,n){e._currentScreen.width=t,e._currentScreen.height=i,e._currentScreen.ppi=n,e._initialized=!0},t.getScale=function(){return e._currentScreen.height/this._designedScreen.height},t.add=function(t,i,n,s,a,o,l){i||(i=e.ALIGN_CENTER),n||(n=e.ALIGN_CENTER),"boolean"!=typeof s&&(s=!1),"number"!=typeof a&&(a=0/0),"number"!=typeof o&&(o=0/0);var r=new cloudkid.UIElementSettings;r.vertAlign=i,r.horiAlign=n,r.titleSafe=s,r.maxScale=o,r.minScale=a,r.centeredHorizontally=l,this._items.push(new cloudkid.UIElement(t,r,this._designedScreen))},e.resizeBackground=function(t){if(e._initialized){var i=t.height/t.scale.y,n=(t.width/t.scale.x,e._currentScreen.height/i);t.scale.x=t.scale.y=n,t.position.x=.5*(e._currentScreen.width-t.width)}},e.resizeBackgrounds=function(e){for(var t=0,i=e.length;i>t;++t)resizeBackground(e[t])},t.resize=function(){if(this._items.length>0)for(var t=0,i=this._items.length;i>t;++t)this._items[t].resize(e._currentScreen)},t.destroy=function(){if(this._items.length>0)for(var e=0,t=this._items.length;t>e;++e)this._items[e].destroy();this._parent=null,this._designedScreen=null,this._items=null},namespace("cloudkid").UIScaler=e}(),function(){function e(e){t._assetUrlCache[e]&&(a=t._assets[e],a&&(a.anim||(a.isFont&&PIXI.BitmapText.fonts[e]&&delete PIXI.BitmapText.fonts[e],PIXI.Texture.destroyTexture(t._assetUrlCache[e]),delete t.scales[e],delete t._assetUrlCache[e])))}{var t=function(){};t.prototype={}}t._assets=null,t._assetUrlCache=null,t.scales=null,t._sizes=null,t._scales=null,t._paths=null,t._sizeOrder=null,t.lowHW=!1,t.init=function(e,i,n){t.scales={},t._assets=e.assets,t._assetUrlCache={},t._paths=e.path,t._sizes=e.sizing,t._scales=e.scale,t._pickScale(i,n)},t.getPreferredSize=function(){return t._sizeOrder[0]},t.getPreferredScale=function(){return t._scales[t._sizeOrder[0]]},t._pickScale=function(e,i){for(var n,s=i>e?e:i,a=t._sizes.length-1;a>=0&&t._sizes[a].maxSize>s;--a)n=t._sizes[a];t._sizeOrder=n.order},t.getUrl=function(e){var i=t._assets[e];if(!i)return null;if(t._assetUrlCache[e])return t._assetUrlCache[e];var n;if(i.anim)return n=t._assetUrlCache[e]=t._paths.anim+i.src;if(t.lowHW&&i.lowHW)return t.scales[e]=t._scales[i.lowHW],n=t._assetUrlCache[e]=t._paths[i.lowHW]+i.src;for(var s=0;s<t._sizeOrder.length;++s){var a=t._sizeOrder[s];if(i[a])return t.scales[e]=t._scales[a],n=t._assetUrlCache[e]=t._paths[a]+i.src}return null},t.unload=function(t){if(t instanceof Array)for(var i=t.length-1;i>=0;--i){var n=t[i];e(n)}else e(t)},t.getAnims=function(e,t,i){void 0===t&&(t=4),0>t&&(t=0);var n,s,a=[],o=[];for(n=1;t>n;++n){var l="";s=1;for(var r=0;n>r;++r)l+="0",s*=10;a.unshift(l),o.push(s)}var u,h=o.length,d=i||{},c=PIXI.Texture.fromFrame;for(var p in e){var g=e[p],_=[];for(n=g.numberMin,len=g.numberMax;len>=n;++n){var b=null;for(s=0;h>s;++s)if(n<o[s]){b=a[s]+n;break}b||(b=n.toString());var f=g.name.replace("#",b),v=c(f,!0);v&&(u=v),_.push(u)}d[p]=_}return d},namespace("cloudkid").AssetManager=t}();